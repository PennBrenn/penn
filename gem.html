<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penn the Page Pet</title>
    
    <style>
        /* --- PET STYLES --- */
        #penn-pet-container {
            position: fixed;
            z-index: 9999; /* Ensure he is on top of everything */
            width: 96px;
            height: 96px;
            pointer-events: auto; /* Allow clicking */
            user-select: none;
            touch-action: none;
            cursor: grab;
        }

        #penn-pet-container.grabbing {
            cursor: grabbing;
        }

        /* The Image Element */
        #penn-pet-img {
            width: 100%;
            height: 100%;
            display: block;
            image-rendering: pixelated; /* Keeps pixel art crisp */
        }

        /* The Name Tag */
        #penn-name {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: sans-serif;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            white-space: nowrap;
        }

        /* Hover Logic for Name */
        #penn-pet-container:hover #penn-name {
            opacity: 1;
        }
    </style>
</head>
<body>

    <script>
    class PagePet {
        constructor() {
            // Configuration
            this.petName = "Penn";
            this.frameRate = 150; // ms per frame
            this.walkSpeed = 3;
            this.climbSpeed = 2;
            this.gravity = 0.8;
            this.bounce = 0.4; // Bounciness when falling
            
            // Animation States
            this.states = {
                IDLE: 'idle',
                WALK_LEFT: 'walk left',
                WALK_RIGHT: 'walk right',
                CLIMB_LEFT: 'climb left',
                CLIMB_RIGHT: 'climb right',
                HANG: 'hang',
                PICKED_UP: 'picked up',
                FALLING: 'falling'
            };

            // Initial State
            this.currentState = this.states.FALLING;
            this.currentFrame = 1;
            this.totalFrames = 6;
            
            // Position & Physics
            this.x = window.innerWidth / 2;
            this.y = 0; // Start at top
            this.vx = 0; // Velocity X
            this.vy = 0; // Velocity Y
            
            // Interaction Flags
            this.isDragging = false;
            this.mouseX = 0;
            this.mouseY = 0;
            this.dragOffsetX = 0;
            this.dragOffsetY = 0;
            this.mouseActiveTimer = null;

            // DOM Setup
            this.createDOM();
            
            // Event Listeners
            this.bindEvents();

            // Start Loops
            this.animLoop = setInterval(() => this.updateAnimation(), this.frameRate);
            this.gameLoop = requestAnimationFrame(() => this.updatePhysics());
        }

        createDOM() {
            // Container
            this.container = document.createElement('div');
            this.container.id = 'penn-pet-container';
            
            // Image
            this.img = document.createElement('img');
            this.img.id = 'penn-pet-img';
            this.img.draggable = false; // Disable native drag
            
            // Name Tag
            this.nameTag = document.createElement('div');
            this.nameTag.id = 'penn-name';
            this.nameTag.innerText = this.petName;

            this.container.appendChild(this.nameTag);
            this.container.appendChild(this.img);
            document.body.appendChild(this.container);
        }

        bindEvents() {
            // Global Mouse Tracking
            window.addEventListener('mousemove', (e) => {
                this.mouseX = e.clientX;
                this.mouseY = e.clientY;
                
                // Wake up interaction logic
                if(this.currentState === this.states.IDLE) {
                    this.decideNextMove();
                }
            });

            // Dragging Events
            this.container.addEventListener('mousedown', (e) => {
                this.isDragging = true;
                this.currentState = this.states.PICKED_UP;
                this.container.classList.add('grabbing');
                
                // Calculate offset so he doesn't snap to center of mouse
                this.dragOffsetX = e.clientX - this.x;
                this.dragOffsetY = e.clientY - this.y;
                
                // Reset velocities
                this.vx = 0;
                this.vy = 0;
            });

            window.addEventListener('mouseup', () => {
                if (this.isDragging) {
                    this.isDragging = false;
                    this.currentState = this.states.FALLING;
                    this.container.classList.remove('grabbing');
                }
            });
        }

        // --- VISUALS ---
        
        updateAnimation() {
            // Cycle Frames 1-6
            this.currentFrame++;
            if (this.currentFrame > this.totalFrames) this.currentFrame = 1;

            // Construct Path: /animations/<action>/frame<x>.png
            // NOTE: Ensure your folder structure matches this exactly
            const path = `animations/${this.currentState}/frame${this.currentFrame}.png`;
            
            // Update Image Source
            this.img.src = path;
        }

        // --- LOGIC & PHYSICS ---

        updatePhysics() {
            const floor = window.innerHeight - 96; // 96 is pet height
            const rightWall = window.innerWidth - 96;

            if (this.isDragging) {
                // Follow Mouse directly
                this.x = this.mouseX - this.dragOffsetX;
                this.y = this.mouseY - this.dragOffsetY;
            } 
            else {
                // --- STATE MACHINE LOGIC ---
                
                // 1. FALLING
                if (this.currentState === this.states.FALLING) {
                    this.vy += this.gravity;
                    this.y += this.vy;

                    // Hit Floor
                    if (this.y >= floor) {
                        this.y = floor;
                        this.vy = -this.vy * this.bounce; // Small bounce
                        
                        if (Math.abs(this.vy) < 1) {
                            this.vy = 0;
                            this.currentState = this.states.IDLE;
                            // Pick a random move after landing
                            setTimeout(() => this.decideNextMove(), 1000);
                        }
                    }
                    // Apply horizontal momentum if falling
                    this.x += this.vx;
                }

                // 2. WALKING
                else if (this.currentState === this.states.WALK_LEFT) {
                    this.x -= this.walkSpeed;
                    if (this.x <= 0) {
                        this.x = 0;
                        this.currentState = this.states.CLIMB_LEFT; // Hit wall, start climb
                    }
                }
                else if (this.currentState === this.states.WALK_RIGHT) {
                    this.x += this.walkSpeed;
                    if (this.x >= rightWall) {
                        this.x = rightWall;
                        this.currentState = this.states.CLIMB_RIGHT; // Hit wall, start climb
                    }
                }

                // 3. CLIMBING
                else if (this.currentState === this.states.CLIMB_LEFT || this.currentState === this.states.CLIMB_RIGHT) {
                    // Try to climb towards mouse height
                    if (this.y > this.mouseY) {
                        this.y -= this.climbSpeed;
                    } else if (this.y < this.mouseY - 10) {
                        this.y += this.climbSpeed;
                    } else {
                        // Reached mouse height on wall
                        this.currentState = this.states.HANG;
                    }

                    // If we hit the ceiling
                    if (this.y <= 0) {
                        this.y = 0;
                        this.currentState = this.states.FALLING;
                    }
                    // If we hit the floor
                    if (this.y >= floor) {
                        this.y = floor;
                        this.currentState = this.states.IDLE;
                    }
                }
                
                // 4. HANGING
                else if (this.currentState === this.states.HANG) {
                    // If mouse moves away significantly, fall or climb
                    if (Math.abs(this.y - this.mouseY) > 150) {
                        this.currentState = this.states.FALLING;
                    }
                }

                // 5. IDLE
                else if (this.currentState === this.states.IDLE) {
                    // Just wait for the next decision or mouse interaction
                }
            }

            // Boundary Checks (Keep inside screen)
            if (this.x < 0) this.x = 0;
            if (this.x > rightWall) this.x = rightWall;
            if (this.y > floor) this.y = floor; // Floor hard stop

            // Apply Render
            this.container.style.left = `${this.x}px`;
            this.container.style.top = `${this.y}px`;

            // Loop
            requestAnimationFrame(() => this.updatePhysics());
        }

        decideNextMove() {
            if (this.isDragging || this.currentState === this.states.FALLING) return;

            // Simple AI: 
            // If on floor, 40% chance to walk to mouse, 40% random walk, 20% idle
            const rand = Math.random();
            const distToMouse = this.mouseX - this.x;

            if (this.y >= window.innerHeight - 100) {
                // We are on the floor
                if (rand < 0.4) {
                    // Walk towards mouse
                    this.currentState = distToMouse < 0 ? this.states.WALK_LEFT : this.states.WALK_RIGHT;
                } else if (rand < 0.8) {
                    // Random walk
                    this.currentState = Math.random() > 0.5 ? this.states.WALK_LEFT : this.states.WALK_RIGHT;
                } else {
                    this.currentState = this.states.IDLE;
                }

                // Change mind after 2-4 seconds
                setTimeout(() => this.decideNextMove(), 2000 + Math.random() * 2000);
            }
        }
    }

    // Initialize the Pet when the page loads
    window.addEventListener('load', () => {
        new PagePet();
    });

</script>
</body>
</html>
