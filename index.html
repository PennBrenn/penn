<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pennbrenn.com | Portfolio</title>
    <meta name="description" content="The official website of Penn Brenn / William Villongco.">
    <link rel="icon" type="image/png" href="Images/favicon96.png">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <!-- FontAwesome for Play/Pause Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JB57Z2S19V"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-JB57Z2S19V');
    </script>

    <style>
        /* --- RESET & VARIABLES --- */
        :root {
            --bg-color: #0b1114;
            --text-color: #e5e7eb;
            --accent-color: #25818e;
            --accent-hover: #1f6f7a;
            --glass-bg: rgba(17, 24, 28, 0.65);
            --glass-border: rgba(255, 255, 255, 0.1);
            --font-main: 'Inter', sans-serif;
            --font-head: 'Poppins', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }

        /* --- NORTHERN LIGHTS BG --- */
        .aurora-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(135deg, #0b1114 0%, #000000 100%);
            overflow: hidden;
        }

        .aurora-light {
            position: absolute;
            width: 150%;
            height: 150%;
            top: -25%;
            left: -25%;
            background: radial-gradient(circle at 50% 50%, rgba(37, 129, 142, 0.15), transparent 60%),
                        radial-gradient(circle at 20% 80%, rgba(30, 200, 150, 0.1), transparent 50%);
            filter: blur(60px);
            animation: auroraShift 20s infinite alternate ease-in-out;
            opacity: 0.6;
        }

        @keyframes auroraShift {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(5deg) scale(1.1); }
            100% { transform: rotate(-5deg) scale(1); }
        }

        /* --- SHOOTING STARS --- */
        .star-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none; /* Let clicks pass through empty space */
            z-index: 1; /* Lowest layer (above -1 background, below content) */
        }

        .shooting-star {
            position: absolute;
            width: 100px; /* Visible tail length, set dynamically in JS */
            height: 2px;
            /* 0deg gradient: bright light is on the LEFT side of the element (head)
               When rotated, this bright end will lead the movement. */
            background: linear-gradient(90deg, rgba(255,255,255,1), transparent);
            border-radius: 50%;
            pointer-events: auto; /* Make the star itself clickable */
            cursor: pointer;
        }
        
        .shooting-star::after {
            content: '';
            position: absolute;
            top: -30px;
            bottom: -30px;
            left: -30px;
            right: -30px;
            background: transparent;
        }

        /* --- SNOWFALL EFFECT (FIXED) --- */
        .snow-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 2; /* Above stars (1), below content (3+) */
            overflow: hidden;
        }

        .snowflake {
            position: absolute;
            background: rgba(255, 255, 255, 0.9); 
            border-radius: 50%;
            opacity: 0.9;
        }

        @keyframes fall {
            to {
                /* TranslateY(100vh) moves it down 100% of the viewport height */
                transform: translateY(100vh); 
            }
        }
        
        @keyframes drift {
            0% { transform: translateX(0); }
            50% { transform: translateX(40px); }
            100% { transform: translateX(0); }
        }

        /* --- LAYOUT UTILITIES --- */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 2rem; /* Even spacing between all sections */
            position: relative; /* Ensure content stacks above effects */
            z-index: 3;
        }

        .glass-panel {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        h1, h2, h3 {
            font-family: var(--font-head);
            color: #fff;
            margin-bottom: 1rem;
        }

        h2 {
            font-size: 1.8rem;
            border-bottom: 2px solid var(--accent-color);
            display: inline-block;
            margin-bottom: 1.5rem;
        }

        a {
            text-decoration: none;
            color: inherit;
            transition: 0.3s;
        }

        img {
            max-width: 100%;
            display: block;
            border-radius: 8px;
        }

        /* --- HEADER --- */
        .site-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(11, 11, 11, 0.95);
            border-bottom: 1px solid var(--glass-border);
            padding: 1rem 0;
        }

        .header-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            font-size: 1.25rem;
            font-weight: 700;
        }
        .brand span { color: var(--accent-color); }

        .music-toggle {
            background: none;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .music-toggle:hover {
            background: var(--accent-color);
            color: white;
        }

        /* --- HERO --- */
        .hero-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }
        @media (min-width: 768px) {
            .hero-grid { grid-template-columns: 2fr 1fr; }
        }

        .status-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.2);
            padding: 1rem;
            border-radius: 8px;
        }
        .status-item span { color: var(--accent-color); font-weight: bold; }
        
        #typewriter-word { color: var(--accent-color); }
        .typewriter-cursor { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        .profile-pic {
            border: 3px solid var(--accent-color);
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
        }

        /* --- SITES SECTION --- */
        .sites-category {
            margin-bottom: 1.5rem;
        }
        .sites-category h3 {
            font-size: 1.2rem;
            color: #aaa;
            margin-bottom: 0.5rem;
        }
        .sites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        .site-card {
            background: rgba(255,255,255,0.05);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid transparent;
            text-align: center;
        }
        .site-card:hover {
            border-color: var(--accent-color);
            background: rgba(37, 129, 142, 0.1);
        }
        .site-name { font-weight: 700; color: #fff; display: block; margin-bottom: 0.2rem;}
        .site-url { font-size: 0.8rem; color: #888; }

        /* --- VOICE TTS --- */
        .voice-controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .voice-input-group {
            display: flex;
            gap: 1rem;
        }
        .voice-input {
            flex: 1;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--glass-border);
            background: rgba(0,0,0,0.3);
            color: white;
        }
        .voice-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 0 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        .voice-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* --- CARDS & HOBBIES (Universal Grid) --- */
        .card-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem; /* Even spacing */
        }
        @media (min-width: 600px) {
            .card-grid { grid-template-columns: repeat(2, 1fr); }
        }
        .card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            overflow: hidden;
            transition: 0.3s;
            height: 100%;
        }
        .card:hover { transform: scale(1.02); }
        .card-img { 
            height: 200px; 
            width: 100%; 
            object-fit: cover; 
            /* Added aspect ratio for placeholder images */
            object-position: center; 
        }
        .card-content { padding: 1rem; }
        .card-title { font-weight: bold; font-size: 1.1rem; color: var(--accent-color); display: block; margin-bottom: 0.5rem; }
        .card-details { font-size: 0.85rem; color: #ccc; }

        .hobbies-flex {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            align-items: center;
        }
        .hobby-list div {
            margin-bottom: 0.5rem;
            padding-left: 1rem;
            border-left: 2px solid var(--accent-color);
        }

        /* --- FOOTER --- */
        footer { text-align: center; padding: 2rem; color: #666; font-size: 0.8rem; }

        /* --- POPUP MODAL --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 200;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: var(--bg-color);
            border: 1px solid var(--accent-color);
            padding: 2rem;
            border-radius: 12px;
            max-width: 400px;
            text-align: center;
            position: relative;
        }
        .close-modal {
            position: absolute;
            top: 10px; right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #aaa;
        }
    </style>
</head>

<body>

    <!-- Animated Aurora Background -->
    <div class="aurora-bg">
        <div class="aurora-light"></div>
    </div>
    
    <!-- Shooting Star Container -->
    <div id="star-container" class="star-container"></div>
    
    <!-- Snowfall Container -->
    <div id="snow-container" class="snow-container"></div>

    <!-- Background Music Audio -->
    <audio id="bg-music" loop>
        <!-- Replace with your actual music file path -->
        <source src="Images/background_music.mp3" type="audio/mpeg">
    </audio>

    <header class="site-header">
        <div class="header-content">
            <a href="./index.html" class="brand"><span>P</span>enn<span>B</span>renn<small>.com</small></a>
            
            <button id="musicBtn" class="music-toggle" onclick="toggleMusic()">
                <i class="fa-solid fa-play"></i> <span>Music</span>
            </button>
        </div>
    </header>

    <main class="container">

        <!-- HERO SECTION -->
        <section class="glass-panel">
            <div class="hero-grid">
                <div>
                    <h1><span id="typewriter-word">Im Penn</span><span class="typewriter-cursor">|</span></h1>
                    <div class="status-bar">
                        <div class="status-item">It is <span id="laTime">Loading...</span> where i am</div>
                        <div class="status-item">There are <span id="days">0</span> days until my birthday</div>
                    </div>
                    <article class="about-text">
                        <h3>üá∫üá∏üè≥Ô∏è‚Äçüåà‚ôÇÔ∏èhe/him</h3>
                        <p><b>PUBLIC PROFILE</b></p>
                        <p><small>Specific information is is not revealed openly.</small></p>
                        <p>Hiiii im penn, the name has no relation to any historical figures. This is the first website that I actually coded. I keep lizards and geckos, and enjoy starting new projects and never finishing them! I play airsoft, I run a hpa gbb kriss vector. I enjoy playing online games with friends.</p>
                        <p style="margin-top: 1rem;"><b>Taken</b></p>
                    </article>
                </div>
                <div class="profile-pic-container">
                    <img src="Images/me.jpg" alt="Penn/William Profile" class="profile-pic">
                </div>
            </div>
        </section>

        <!-- SITES SECTION -->
        <section class="glass-panel">
            <h2>Sites</h2>
            
            <div class="sites-category">
                <h3>Professional "Stuff"</h3>
                <div class="sites-grid">
                    <a href="https://cam.pennbrenn.com" class="site-card">
                        <span class="site-name">penncamm</span>
                        <span class="site-url">cam.pennbrenn.com</span>
                    </a>
                    <a href="https://www.pennbrenn.com" class="site-card">
                        <span class="site-name">about me</span>
                        <span class="site-url">pennbrenn.com</span>
                    </a>
                </div>
            </div>

            <div class="sites-category">
                <h3>Game "Stuff"</h3>
                <div class="sites-grid">
                    <a href="https://play.pennbrenn.com" class="site-card">
                        <span class="site-name">Question Game</span>
                        <span class="site-url">play.pennbrenn.com</span>
                    </a>
                    <a href="https://play.bbcjustice.top" class="site-card">
                        <span class="site-name">bbcjustice</span>
                        <span class="site-url">play.bbcjustice.top</span>
                    </a>
                    <a href="https://sam.pennbrenn.com" class="site-card">
                        <span class="site-name">Sams Aura Farm</span>
                        <span class="site-url">sam.pennbrenn.com</span>
                    </a>
                </div>
            </div>

            <div class="sites-category">
                <h3>Old "Stuff"</h3>
                <div class="sites-grid">
                    <a href="https://moveon.pennbrenn.com/" class="site-card">
                        <span class="site-name">move on lol</span>
                        <span class="site-url">moveon.pennbrenn.com</span>
                    </a>
                    <a href="https://2guys1mic.top" class="site-card">
                        <span class="site-name">2g1m</span>
                        <span class="site-url">2guys1mic.top</span>
                    </a>
                    <a href="#" class="site-card" style="opacity: 0.5;">
                        <span class="site-name">old games/missing</span>
                        <span class="site-url">Offline</span>
                    </a>
                </div>
            </div>
        </section>

        <!-- HEAR MY VOICE SECTION -->
        <section class="glass-panel">
            <h2>Hear My Voice</h2>
            <p style="margin-bottom: 1rem; color: #aaa;">Type something to hear me say it using AI. (Profanity filters active).</p>
            <div class="voice-controls">
                <div class="voice-input-group">
                    <input type="text" id="ttsInput" class="voice-input" placeholder="Type up to 100 chars..." maxlength="100">
                    <button id="ttsBtn" class="voice-btn" onclick="generateSpeech()">Speak</button>
                </div>
                <audio id="ttsAudio" controls style="width: 100%; display: none;"></audio>
                <div id="ttsStatus" style="font-size: 0.9rem; color: var(--accent-color);"></div>
            </div>
        </section>

        <!-- FOR BUSINESS SECTION -->
        <section class="glass-panel">
            <h2>For Business</h2>
            <div style="border-left: 2px solid var(--accent-color); padding-left: 1.5rem;">
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.2rem; color: white;">Education</h3>
                    <p><strong>Graduated High School</strong> | 2024</p>
                    <p style="font-size: 0.9rem; color: #ccc;">Relevant Coursework: Computer Science, Physics.</p>
                </div>
                <div>
                    <h3 style="font-size: 1.2rem; color: white;">Skills</h3>
                    <p>HTML / CSS / Basic JS</p>
                    <p>Business Management & Startup Experience</p>
                    <p>3D Printing & Prototyping</p>
                </div>
            </div>
        </section>

        <!-- GAMES SECTION -->
        <section class="glass-panel">
            <h2>My Fav Games</h2>
            <div class="card-grid">
                <div class="card">
                    <img src="Images/storm1.jpg" alt="Stormworks" class="card-img">
                    <div class="card-content">
                        <a href="https://store.steampowered.com/app/573090/Stormworks_Build_and_Rescue/" class="card-title">#1 Stormworks</a>
                        <p class="card-details">Build anything simulator</p>
                    </div>
                </div>
                <div class="card">
                    <img src="Images/star1.jpg" alt="Star Citizen" class="card-img">
                    <div class="card-content">
                        <a href="https://robertsspaceindustries.com/en/" class="card-title">#2 Star Citizen</a>
                        <p class="card-details">Do whatever simulator</p>
                    </div>
                </div>
                <div class="card">
                    <img src="Images/people.jpg" alt="People Playground" class="card-img">
                    <div class="card-content">
                        <a href="https://store.steampowered.com/app/1118200/People_Playground/" class="card-title">#3 People Playground</a>
                        <p class="card-details">War crime simulator</p>
                    </div>
                </div>
                <div class="card">
                    <img src="Images/liero1.jpg" alt="Liero" class="card-img">
                    <div class="card-content">
                        <a href="https://www.liero.be/" class="card-title">#4 Liero</a>
                        <p class="card-details">1v1 simulator</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- PETS SECTION -->
        <section class="glass-panel">
            <h2>My Pets</h2>
            <div class="card-grid">
                <!-- Existing Pets -->
                <div class="card">
                    <img src="Images/pennclavebig.jpg" alt="Mourning Geckos" class="card-img">
                    <div class="card-content">
                        <div class="card-title">The Pennclave</div>
                        <div class="card-details">
                            <div>Mourning geckos x4</div>
                            <div>40 gal bioactive</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <img src="Images/trickbig.jpg" alt="Trick" class="card-img">
                    <div class="card-content">
                        <div class="card-title">Trick</div>
                        <div class="card-details">
                            <div>Kitty :3</div>
                            <div>He yearns for food</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <img src="Images/pennbig.jpg" alt="Penn" class="card-img">
                    <div class="card-content">
                        <div class="card-title">Penn</div>
                        <div class="card-details">
                            <div>Alligator Lizard</div>
                            <div>2022</div>
                        </div>
                    </div>
                </div>
                
                <!-- Gizmo (Crested Gecko) -->
                <div class="card">
                    <!-- Placeholder image using accent color -->
                    <img src="https://placehold.co/400x200/25818e/ffffff?text=Gizmo" alt="Gizmo" class="card-img">
                    <div class="card-content">
                        <div class="card-title">Gizmo</div>
                        <div class="card-details">
                            <div>Crested Gecko</div>
                            <div>Loves fruit puree</div>
                        </div>
                    </div>
                </div>
                
                <!-- Sparky (Leopard Gecko) -->
                <div class="card">
                    <!-- Placeholder image using accent color -->
                    <img src="https://placehold.co/400x200/25818e/ffffff?text=Sparky" alt="Sparky" class="card-img">
                    <div class="card-content">
                        <div class="card-title">Sparky</div>
                        <div class="card-details">
                            <div>Leopard Gecko</div>
                            <div>The shy one</div>
                        </div>
                    </div>
                </div>
                
            </div>
        </section>

        <!-- HOBBIES -->
        <section class="glass-panel">
            <h2>Hobbies</h2>
            <div class="hobbies-flex">
                <div class="hobby-list">
                    <div>‚Ä£ Airsoft</div>
                    <div>‚Ä£ Petting cat</div>
                    <div>‚Ä£ Gaming</div>
                    <div>‚Ä£ Sailing</div>
                    <div>‚Ä£ 3d printing</div>
                    <div>‚Ä£ Making things</div>
                </div>
                <div>
                    <img src="Images/printer.jpg" alt="3D Printer" style="max-width: 250px; border-radius: 8px;">
                </div>
            </div>
        </section>

        <!-- OUT AND ABOUT -->
        <section class="glass-panel">
            <h2>Fav Out & About</h2>
            <div class="card-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                <div class="card">
                    <img src="Images/opensause.jpg" alt="Opensauce" class="card-img">
                    <div class="card-content"><div class="card-title">Opensauce 2025</div></div>
                </div>
                <div class="card">
                    <img src="Images/dc.jpg" alt="DC" class="card-img">
                    <div class="card-content"><div class="card-title">Washington DC</div></div>
                </div>
                <div class="card">
                    <img src="Images/airsoftcon.jpg" alt="Airsoftcon" class="card-img">
                    <div class="card-content"><div class="card-title">Airsoftcon 2024</div></div>
                </div>
            </div>
        </section>

    </main>

    <footer>
        <p>&copy; 2025 Penn Brenn. All rights reserved.</p>
    </footer>

    <!-- FACT POPUP MODAL -->
    <div id="factModal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-modal" onclick="closePopup()">&times;</span>
            <h3 style="color: var(--accent-color);">Random Fact!</h3>
            <p id="factText" style="margin-top: 1rem; font-size: 1.1rem;"></p>
        </div>
    </div>

    <script>
        // --- 1. TIME & BIRTHDAY ---
        function updateTime() {
            const options = { timeZone: 'America/Los_Angeles', hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true };
            document.getElementById('laTime').textContent = new Date().toLocaleTimeString('en-US', options);
        }
        setInterval(updateTime, 1000);
        updateTime();

        function updateBirthday() {
            const today = new Date();
            let nextBday = new Date(today.getFullYear(), 10, 17); // Nov 17
            if (today > nextBday) nextBday.setFullYear(today.getFullYear() + 1);
            const diff = Math.ceil((nextBday - today) / (1000 * 60 * 60 * 24));
            document.getElementById("days").textContent = diff;
        }
        updateBirthday();

        // --- 2. MUSIC PLAYER ---
        const audio = document.getElementById("bg-music");
        audio.volume = 0.3; // Lower volume
        let isPlaying = false;
        
        function toggleMusic() {
            const btn = document.getElementById("musicBtn");
            if (isPlaying) {
                audio.pause();
                btn.innerHTML = '<i class="fa-solid fa-play"></i> <span>Music</span>';
            } else {
                audio.play();
                btn.innerHTML = '<i class="fa-solid fa-pause"></i> <span>Pause</span>';
            }
            isPlaying = !isPlaying;
        }

        // --- 3. SHOOTING STARS & FACTS (Rotation Fixed) ---
        const facts = [
            "I own 4 geckos.",
            "I play HPA GBB Kriss Vector in Airsoft.",
            "I want to start an aircraft business.",
            "I built this site myself.",
            "My cat's name is Trick."
        ];

        function spawnStar() {
            const container = document.getElementById('star-container');
            const star = document.createElement('div');
            star.classList.add('shooting-star');
            
            const viewportW = window.innerWidth;
            const viewportH = window.innerHeight;
            
            const startEdge = Math.floor(Math.random() * 4); // 0=Top, 1=Right, 2=Bottom, 3=Left
            
            let startX, startY, endX, endY, rotationAngle;

            const length = Math.random() * 50 + 80; // Star tail length (80px to 130px)
            star.style.width = length + 'px';
            const duration = Math.random() * 4 + 4; // 4 to 8 seconds

            // Determine Start/End points
            if (startEdge === 0) { // Top -> Down/Diagonal
                startX = Math.random() * viewportW;
                startY = -50;
                endX = startX + (Math.random() - 0.5) * viewportW * 0.5;
                endY = viewportH + 50;
            } else if (startEdge === 1) { // Right -> Left/Diagonal
                startX = viewportW + 50;
                startY = Math.random() * viewportH;
                endX = -50;
                endY = startY + (Math.random() - 0.5) * viewportH * 0.5;
            } else if (startEdge === 2) { // Bottom -> Up/Diagonal
                startX = Math.random() * viewportW;
                startY = viewportH + 50;
                endX = startX + (Math.random() - 0.5) * viewportW * 0.5;
                endY = -50;
            } else { // 3: Left -> Right/Diagonal
                startX = -50;
                startY = Math.random() * viewportH;
                endX = viewportW + 50;
                endY = startY + (Math.random() - 0.5) * viewportH * 0.5;
            }

            const deltaX = endX - startX;
            const deltaY = endY - startY;

            // FIX: Removed the + 180 to ensure the bright end (gradient at 90deg,
            // which is the left side of the element's local coordinate system)
            // leads the direction of travel (deltaX, deltaY).
            rotationAngle = Math.atan2(deltaY, deltaX) * (180 / Math.PI) - 180;

            star.style.top = startY + 'px';
            star.style.left = startX + 'px';
            star.style.transition = `transform ${duration}s linear`;
            
            // Apply rotation and initial position
            star.style.transform = `rotate(${rotationAngle}deg)`;
            
            container.appendChild(star);
            
            // Trigger move after render
            setTimeout(() => {
                // Apply translation, ensuring rotation is maintained
                star.style.transform = `translate(${deltaX}px, ${deltaY}px) rotate(${rotationAngle}deg)`;
            }, 50);

            // Interaction
            star.addEventListener('click', () => {
                const randomFact = facts[Math.floor(Math.random() * facts.length)];
                document.getElementById('factText').textContent = randomFact;
                document.getElementById('factModal').style.display = 'flex';
                star.remove(); // Remove clicked star
            });

            // Cleanup
            setTimeout(() => { star.remove(); }, duration * 1000);
        }

        // Spawn a star more frequently (every 1 second)
        setInterval(spawnStar, 1000);

        function closePopup() {
            document.getElementById('factModal').style.display = 'none';
        }

        // --- 4. TTS (ELEVENLABS) ---
        // Expanded Profanity list for age-appropriate safety.
        const badWords = [
            "darn", "heck", "silly", "poop", "butt", "crap", "gross", "awful",
            "stupid", "idiot", "hate", "kill", "die", "swear", "rude", "mean", 
            "bully", "fight", "abuse", "vandalize", "destroy", "bomb", "gun", "knife",
            "terror", "danger", "grief", "sadness", "broken", "jerk", "freak", "loser",
            "sucks", "stinks", "dumb", "ugly"
        ];
        
        async function generateSpeech() {
            const input = document.getElementById('ttsInput');
            const status = document.getElementById('ttsStatus');
            const btn = document.getElementById('ttsBtn');
            const text = input.value.trim();
            const player = document.getElementById('ttsAudio');

            if (!text) return;

            // Profanity Check
            const lowerText = text.toLowerCase();
            const hasProfanity = badWords.some(word => lowerText.includes(word));
            
            if (hasProfanity) {
                console.log("Profanity detected in user input.");
                // Using a simple alert, as per previous implementation
                alert("Let's keep it clean to protect Penn! Please use friendly language.");
                return;
            }

            status.textContent = "Generating voice...";
            btn.disabled = true;

            try {
                // This assumes a Vercel/similar endpoint is set up to handle the TTS API call
                const response = await fetch('/api/speak', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: text })
                });

                if (!response.ok) throw new Error("API Error");

                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                player.src = url;
                player.style.display = 'block';
                player.play();
                status.textContent = "Playing...";
            } catch (err) {
                console.error("TTS Generation Error:", err);
                status.textContent = "Error generating audio.";
            } finally {
                btn.disabled = false;
            }
        }

        // --- 5. TYPEWRITER ---
        (function () {
            const words = ["Im Penn", "Im William"];
            const el = document.getElementById("typewriter-word");
            let wordIndex = 0, charIndex = 0, typing = true;
            
            function tick() {
                const current = words[wordIndex];
                if (typing) {
                    charIndex++;
                    el.textContent = current.slice(0, charIndex);
                    if (charIndex === current.length) { typing = false; setTimeout(tick, 2000); return; }
                } else {
                    charIndex--;
                    el.textContent = current.slice(0, charIndex);
                    if (charIndex === 0) { typing = true; wordIndex = (wordIndex + 1) % words.length; }
                }
                setTimeout(tick, typing ? 100 : 50);
            }
            tick();
        })();

        // --- 6. SNOWFALL EFFECT (FIXED animation logic) ---
        function createSnowflake() {
            const container = document.getElementById('snow-container');
            if (!container) return;

            const flake = document.createElement('div');
            flake.classList.add('snowflake');

            // Increased size range for visibility
            const size = Math.random() * 5 + 2; // 2px to 7px
            flake.style.width = flake.style.height = `${size}px`;

            const startX = Math.random() * window.innerWidth;
            const startY = -size;
            flake.style.left = `${startX}px`;
            flake.style.top = `${startY}px`;
            
            const duration = Math.random() * 20 + 10; // 10s to 30s
            const delay = Math.random() * -duration; // Start randomly throughout the animation cycle
            const driftDuration = Math.random() * 10 + 5; // 5s to 15s for drift

            // FIX: Using the animation shorthand for combining the two keyframes
            // fall {duration}s linear {delay}s infinite
            // drift {driftDuration}s ease-in-out infinite alternate
            flake.style.animation = `fall ${duration}s linear ${delay}s infinite, drift ${driftDuration}s ease-in-out infinite alternate`;
            
            container.appendChild(flake);

            // Cleanup after a long time (max fall time + some buffer)
            setTimeout(() => { flake.remove(); }, 35000); 
        }

        // Generate a larger initial burst of snowflakes for density
        const initialFlakes = 150;
        for (let i = 0; i < initialFlakes; i++) {
            createSnowflake();
        }
        // Maintain a steady stream of new flakes more frequently
        setInterval(createSnowflake, 100); 

    </script>
</body>
</html>
